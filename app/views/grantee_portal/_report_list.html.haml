- documentable_class = "RequestReport"
.titlebar
  %h4
    Reports
.content
  - if @data.count == 0
    %p.caption{:colspan => 6}=raw "No reports"
  - else
    %table{:cellspacing => 0}
      %thead
        %tr
          %th
            Report
          %th
            Due Date
          %th
            Status
      -@data.each do |model|
        - documentable_id = model.id
        - state = "Approved"
        - state = "Due" if model.in_state_with_category?("new")
        - state = "Submitted" if model.in_state_with_category?("approval")
        - state = "Sent Back" if model.in_state_with_category?("sent_back")
        - state = "" if model.state.nil?
        %tbody
          %tr
            %td= "#{model.type_to_english} for #{model.request.grant_id}"
            %td= mdy_date_format(model.due_at)
            %td
              = state
              - if state == 'Due'
                %span= link_to "Submit", request_report_path(model.id, "event_action".to_sym => "receive_report", "request_report[workflow_note]".to_sym => "Received from Grantee Portal"), :class => "submit-report"
                %span= link_to "Upload", model_documents_path(:model_document => {:documentable_id => documentable_id, :documentable_type => documentable_class}), :class => 'to-upload', 'data-extensions'.to_sym=>"txt,zip,gz,pdf,png,jpg,gif,xls,doc,xlsx,docx,ppt,pptx", :title => "Add Document", 'data-document-type-url' => model_document_types_path(:model_type => documentable_class, :name => 'associated_request_documents', :format => :json), 'data-document-type-param' => 'model_document[model_document_type_id]'
          -model.model_documents.each do |doc|
            - if doc
              %tr
                %td{:colspan => 5}
                  = link_to doc.document_file_name, doc.document.url, :target => '_blank', :class => mime_type_to_class(doc.document_content_type)
    = render :partial => "grantee_portal/paging_actions"